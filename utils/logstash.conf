input {
  beats {
    port => 5044
  }
}
filter {
  if [fields][source] == "cowrie" {
    mutate {
      add_field => {
        "attackerIP" => "%{src_ip}"
        "eventType" => "%{eventid}"
        "protocol" => "SSH/Telnet"
        "source" => "cowrie"
      }
    }
  } else if [fields][source] == "dionaea" {
    mutate {
      add_field => {
        "attackerIP" => "%{remote_host}"
        "eventType" => "%{type}"
        "protocol" => "%{protocol}"
        "source" => "dionaea"
      }
    }
  }
  mutate {
    remove_field => [ "host", "tags", "fields", "input", "ecs", "agent", "log" ]
  }
}
output {
  http {
    http_method => "post"
    url => "${BACKEND_URL}/api/events"
    headers => {
      "X-API-Key" => "${API_KEY}"
      "Content-Type" => "application/json"
    }
    format => "json"
    retry_failed => true
    retry_non_idempotent => true
  }
  stdout {
    codec => rubydebug
  }
}
