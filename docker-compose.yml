version: '3.8'
services:
  cowrie:
    image: cowrie/cowrie:latest
    ports:
      - "2222:2222"
      - "2223:2223"
    volumes:
      - ./logs/cowrie:/cowrie/var/log/cowrie
      - ./enrichers:/enrichers
    networks:
      - honeypot-net
    restart: unless-stopped
  glastopf:
    image: decepot/glastopf:latest
    ports:
      - "80:80"
    volumes:
      - ./logs/glastopf:/var/log/glastopf
      - ./enrichers:/enrichers
    networks:
      - honeypot-net
    restart: unless-stopped
  dionaea:
    image: dinotools/dionaea:latest
    ports:
      - "21:21"
      - "42:42"
      - "135:135"
      - "443:443"
      - "445:445"
      - "1433:1433"
      - "1723:1723"
      - "3306:3306"
      - "5060:5060"
      - "5061:5061"
    volumes:
      - ./logs/dionaea:/opt/dionaea/var/log
      - ./enrichers:/enrichers
    networks:
      - honeypot-net
    restart: unless-stopped
  log-enricher:
    build:
      context: ./enrichers
      dockerfile: Dockerfile
    volumes:
      - ./logs:/app/logs
      - /var/run/docker.sock:/var/run/docker.sock
    environment:
      - NODE_ENV=production
    networks:
      - honeypot-net
    depends_on:
      - cowrie
      - glastopf
      - dionaea
    restart: unless-stopped
  dashboard:
    build: ./dashboard
    ports:
      - "${DASHBOARD_PORT}:3000"
    volumes:
      - ./logs:/app/logs
      - /var/run/docker.sock:/var/run/docker.sock
    environment:
      - NODE_ENV=production
    networks:
      - honeypot-net
    depends_on:
      - log-enricher
    restart: unless-stopped
  reverse-proxy:
    image: nginx:alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./config/nginx.conf:/etc/nginx/nginx.conf:ro
    networks:
      - honeypot-net
    depends_on:
      - dashboard
    restart: unless-stopped
networks:
  honeypot-net:
    driver: bridge
    internal: false
